import type { Service } from "@shared/storeTypes";

/**
 * Объединённый тип, описывающий полный возвращаемый объект хука
 * {@link useServices}.
 *
 * Содержит как данные состояния (список услуг, поля формы, ошибки и т.д.),
 * так и функции для управления этим состоянием через Redux.
 */
export type UseServicesReturn = UseServicesData & UseServicesActions;

/**
 * Тип, представляющий доступные поля формы при редактировании или создании
 * услуги.
 *
 * Используется для типобезопасного обновления отдельных полей формы
 */
export type FormFields = "name" | "price";

/**
 * Интерфейс, описывающий данные, предоставляемые хуком {@link useServices}.
 *
 * Отражает часть состояния, связанную с:
 * - списком услуг,
 * - текущим состоянием формы редактирования/создания,
 * - контекстом редактирования (ID редактируемой записи),
 * - ошибками валидации,
 * - агрегированными значениями (например, общее количество услуг).
 */
export interface UseServicesData {
	/** Массив всех доступных услуг. */
	items: Service[];

	/** Массив услуг, отфильтрованный по текущему состоянию поиска. */
	filteredItems: Service[];

	/** Текущее значение поля "Название" в форме. */
	name: string;

	/** Текущее значение поля "Цена" в форме (в виде строки). */
	price: string;

	/**
	 * Идентификатор редактируемой услуги.
	 * Равен `null`, если форма находится в режиме создания новой записи.
	 */
	editingId: string | null;

	/**
	 * Объект ошибок валидации, где ключ — имя поля ({@link FormFields} 
   * или другое), а значение — сообщение об ошибке.
	 */
	errors: Record<string, string>;

	/** Общее количество услуг (агрегированное значение из состояния). */
	total: number;

	/** Количество найденных услуг (агрегированное значение из состояния). */
	found: number;

	/** Текущее значение поля поиска. */
	searchTerm: string;

	/** Флаг, указывающий на наличие пустого результата поиска. */
	isEmptyResult: boolean;

	/** Флаг, указывающий на наличие активного поиска. */
	hasActiveSearch: boolean;
}

/**
 * Интерфейс, описывающий действия (методы), предоставляемые хуком 
 * {@link useServices}.
 *
 * Все методы вызывают соответствующие Redux-экшены и обеспечивают
 * иммутабельное обновление глобального состояния.
 */
export interface UseServicesActions {
		/**
		 * Добавляет новую услугу в список.
		 *
		 * @param {string} name Название услуги.
		 * @param {number} price Стоимость услуги (число).
		 */
		addService: (name: string, price: number) => void;

		/**
		 * Обновляет существующую услугу по её идентификатору.
		 *
		 * @param {string} id Идентификатор обновляемой услуги.
		 * @param {string} name Новое название услуги.
		 * @param {number} price Новая стоимость услуги (число).
		 */
		updateService: (id: string, name: string, price: number) => void;

		/**
		 * Удаляет все услуги.
		 */
		deleteAllServices: () => void;

		/**
		 * Удаляет услугу по её идентификатору.
		 *
		 * @param {string} id Идентификатор удаляемой услуги.
		 */
		deleteService: (id: string) => void;

		/**
		 * Запускает режим редактирования для указанной услуги.
		 * Заполняет форму её текущими данными и устанавливает
		 * {@link UseServicesData.editingId}.
		 *
		 * @param {Service} service Объект услуги, которую требуется отредактировать.
		 */
		startEditing: (service: Service) => void;

		/**
		 * Отменяет текущий режим редактирования и сбрасывает форму к пустому
		 * состоянию.
		 */
		cancelEditing: () => void;

		/**
		 * Полностью очищает форму (поля и ошибки валидации).
		 */
		clearForm: () => void;

		/**
		 * Обновляет значение одного из полей формы.
		 *
		 * @param {FormFields} field Имя поля ({@link FormFields}).
		 * @param {string} value Новое значение поля (всегда передаётся как строка).
		 */
		setFormField: (field: FormFields, value: string) => void;

		/**
		 * Устанавливает или сбрасывает сообщение об ошибке для указанного поля.
		 *
		 * @param {string} field Имя поля (может выходить за пределы
		 * {@link FormFields}).
		 * @param {string} error Сообщение об ошибке. Если строка пустая
		 * или `undefined` — ошибка считается сброшенной.
		 */
		setValidationError: (field: string, error: string) => void;

		/**
		 * Обновляет значение поля поиска.
		 *
		 * @param {string} term Новое значение поля поиска.
		 */
		setSearchTerm: (term: string) => void;

		/**
		 * Очищает значение поля поиска.
		 */
		clearSearch: () => void;
	}
